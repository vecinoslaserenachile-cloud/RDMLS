<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serenito App - Simulación Reactiva de Protocolo Municipal</title>
    <style>
        /* CSS BÁSICO PARA ESTRUCTURAR LA DEMO */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            padding: 20px;
        }
        h1, h2 { color: #003366; } /* Color municipal La Serena */
        .app-container {
            display: flex;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .col {
            flex: 1;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* ESTILOS PARA LA COLUMNA 1 (PUERTA) */
        #checkin-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        .autoridad-btn {
            background-color: #e3f2fd;
            border: 2px solid #90caf9;
            color: #0d47a1;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
        }
        .autoridad-btn:hover { background-color: #bbdefb; }
        .autoridad-btn.presente {
            background-color: #81c784; /* Verde: Llegó */
            border-color: #66bb6a;
            color: white;
            font-weight: bold;
        }
        .rango-tag {
            font-size: 0.8em;
            background-color: rgba(0,0,0,0.1);
            padding: 2px 6px;
            border-radius: 4px;
            float: right;
        }

        /* ESTILOS PARA LA COLUMNA 2 (LOCUTOR) - MIMIC MOCKUP */
        #pantalla-locutor {
            background-color: #000; /* Fondo Negro (image_1.png) */
            color: #fff;
            padding: 30px;
            border-radius: 10px;
            min-height: 200px;
            border: 4px solid #FFD700; /* Borde amarillo de 'Mic' */
        }
        .announcer-text {
            font-size: 1.2em;
            line-height: 1.6;
            color: #FFD700; /* Texto Amarillo/Dorado */
            font-family: 'Courier New', Courier, monospace; /* Tipografía para leer */
        }
        .alert-text {
            color: #ff5252;
            font-weight: bold;
            font-style: italic;
        }
        strong { font-weight: bold; color: white; }
    </style>
</head>
<body>

    <header style="text-align: center; margin-bottom: 20px;">
        <h1 style="margin: 0;">SERENITO APP</h1>
        <p style="margin: 5px 0 0; color: #666;">PROTOCOLO & EVENTOS</p>
    </header>

    <div class="app-container">
        <div class="col" id="col-puerta">
            <h2>1. Acreditación de Autoridades (Simulación de Puerta)</h2>
            <p>Haz clic en cada autoridad para marcar su check-in (llegada al evento).</p>
            <div id="checkin-buttons">
                </div>
        </div>

        <div class="col" id="col-locutor">
            <h2>2. Pestaña del Locutor (Vocativos Oficiales en vivo)</h2>
            <p>Esta vista reacciona instantáneamente a quién ha hecho Check-in en la Puerta.</p>
            <div id="pantalla-locutor">
                <div class="announcer-text" id="vocativos-actualizados">
                    </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA Y LÓGICA CENTRAL DE PROTOCOLO (JavaScript) ---

        // 1. LA MATRIZ DE PRECEDENCIA (JSON)
        // Definimos el orden jerárquico oficial. El número menor de rango_precedencia indica más jerarquía.
        // Incluye los nombres actualizados: Daniela Norambuena, etc.
        const autoridadesProtocolo = [
            { id: 1, cargo: "Gobernadora Regional", nombre: "Krist Naranjo", rango_precedencia: 1, presente: false },
            { id: 2, cargo: "Delegado Presidencial", nombre: "Galos Luna", rango_precedencia: 2, presente: false },
            { id: 3, cargo: "Alcaldesa de La Serena", nombre: "Daniela Norambuena", rango_precedencia: 3, presente: false }, // User corrected name
            { id: 4, cargo: "Cuerpo de Concejales", nombre: "Sres. Concejales de la Comuna", rango_precedencia: 4, presente: false },
            { id: 5, cargo: "Diputados del Distrito", nombre: "Honorables Diputados", rango_precedencia: 5, presente: false }
        ];

        // 2. FUNCIÓN DE INICIALIZACIÓN: Dibuja los botones de la puerta por primera vez
        function inicializarDemo() {
            renderGateButtons();
            // Al inicio, no hay nadie presente, por lo que la pantalla del locutor dice "esperando"
            actualizarPantallaLocutor('<p class="alert-text">Atención: No se registran autoridades acreditadas aún.</p>');
        }

        // 3. FUNCIÓN DE RENDERIZADO: Crea/actualiza los botones en la 'Puerta'
        function renderGateButtons() {
            const container = document.getElementById('checkin-buttons');
            container.innerHTML = ''; // Limpiar botones anteriores

            autoridadesProtocolo.forEach(autoridad => {
                const btn = document.createElement('button');
                btn.className = 'autoridad-btn';
                btn.onclick = () => marcarCheckIn(autoridad.id);

                // Estado visual si está presente
                if (autoridad.presente) {
                    btn.className += ' presente';
                    btn.innerHTML = `<span class="rango-tag">${autoridad.rango_precedencia}</span> ${autoridad.cargo} (PRESENTE)`;
                    btn.disabled = true; // No re-acreditar
                } else {
                    btn.innerHTML = `<span class="rango-tag">${autoridad.rango_precedencia}</span> Acreditar: ${autoridad.cargo}`;
                }

                container.appendChild(btn);
            });
        }

        // 4. LÓGICA DE CHECK-IN: Marca llegada y dispara la actualización protocolar
        function marcarCheckIn(idAutoridad) {
            // A. Actualizar estado en la base de datos simulada
            const autoridad = autoridadesProtocolo.find(a => a.id === idAutoridad);
            if (autoridad) {
                autoridad.presente = true;
                console.log(`Logística: ${autoridad.nombre} ha ingresado.`);
            }

            // B. Actualizar visualmente la puerta
            renderGateButtons();

            // C. DISPARAR REACCIÓN PROTOCOLAR: Recalcular vocativos y actualizar locutor
            calcularYActualizarVocativos();
        }

        // 5. EL CEREBRO DE PROTOCOLO: Filtra, Ordena y Genera el Vocativo Dynamic
        function calcularYActualizarVocativos() {
            // A. Filtrar solo los presentes
            const presentes = autoridadesProtocolo.filter(a => a.presente);

            // B. Ordenar por Rango de Precedencia (Número menor primero)
            presentes.sort((a, b) => a.rango_precedencia - b.rango_precedencia);

            // C. Generar el texto dinámico para el locutor
            let textoVocativosHTML = '';

            if (presentes.length === 0) {
                textoVocativosHTML = '<p class="alert-text">Atención: No se registran autoridades acreditadas aún.</p>';
            } else {
                presentes.forEach((autoridad, index) => {
                    // El primero de la lista sorted presides.
                    const prefijo = (index === 0)
                        ? `Saludamos a quien preside este acto, `
                        : `Saludamos también a `;

                    // Formato de nombre y cargo
                    textoVocativosHTML += `<p>${prefijo} <strong>${autoridad.cargo}</strong>, ${autoridad.nombre}.</p>`;
                });
            }

            // D. Actualizar la Pantalla del Locutor
            actualizarPantallaLocutor(textoVocativosHTML);
        }

        // 6. FUNCIÓN DE ACTUALIZACIÓN DEL DOM: Empuja el texto a la pantalla del locutor
        function actualizarPantallaLocutor(textHTML) {
            const target = document.getElementById('vocativos-actualizados');
            target.innerHTML = textHTML;
        }

        // INICIAR LA SIMULACIÓN
        inicializarDemo();
    </script>
</body>
</html>
